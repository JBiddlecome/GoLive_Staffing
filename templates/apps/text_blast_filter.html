{% extends "base.html" %}
{% block title %}Text Blast Filter â€” GoLive Tools{% endblock %}
{% block content %}
<h1 class="text-xl font-semibold mb-6">Text Blast Filter</h1>

<div class="grid gap-8">
  <section class="p-6 bg-white border border-gray-200 rounded-xl shadow-sm">
    <h2 class="text-lg font-semibold mb-4">Available Employees From Event</h2>
    <p class="text-sm text-gray-600 mb-4">Upload the event roster exported as an .xlsx file. The tool will remove the first three rows and prepare the data for filtering.</p>
    <form class="space-y-4" method="post" enctype="multipart/form-data" action="/text-blast-filter/upload">
      <div>
        <label class="block text-sm font-medium mb-1" for="file">Event roster (.xlsx)</label>
        <input class="border rounded-lg p-2 w-full bg-white" type="file" id="file" name="file" accept=".xlsx" required />
      </div>
      <button class="px-4 py-2 rounded-lg border border-slate-300 shadow-sm bg-slate-50 hover:bg-slate-100" type="submit">Upload Roster</button>
    </form>
    {% if uploaded_filename %}
    <p class="mt-4 text-sm text-green-700">Loaded file: <span class="font-medium">{{ uploaded_filename }}</span></p>
    {% endif %}
    {% if error %}
    <p class="mt-4 text-sm text-red-600">{{ error }}</p>
    {% endif %}
  </section>

  <section class="p-6 bg-white border border-gray-200 rounded-xl shadow-sm">
    <h2 class="text-lg font-semibold mb-4">Employee List Filter</h2>
    {% if options %}
    <form class="space-y-4" method="post" action="/text-blast-filter/process">
      <input type="hidden" name="file_token" value="{{ file_token }}" />
      <div>
        <label class="block text-sm font-medium mb-1" for="shift_position_title">Shift Position Title</label>
        <select class="border rounded-lg p-2 w-full bg-white" id="shift_position_title" name="shift_position_title">
          <option value="">All positions</option>
          {% for value in options.shift_positions %}
          <option value="{{ value }}" {% if selected.shift_position_title == value %}selected{% endif %}>{{ value }}</option>
          {% endfor %}
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium mb-1" for="employee_status">Employee Status</label>
        <select class="border rounded-lg p-2 w-full bg-white" id="employee_status" name="employee_status">
          <option value="">All statuses</option>
          {% for value in options.employee_statuses %}
          <option value="{{ value }}" {% if selected.employee_status == value %}selected{% endif %}>{{ value }}</option>
          {% endfor %}
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium mb-1" for="miles_from_location">Miles from Location</label>
        <input class="border rounded-lg p-2 w-full bg-white" type="number" id="miles_from_location" name="miles_from_location" value="{{ selected.miles_from_location }}" min="0" step="1" />
        <p class="text-xs text-gray-500 mt-1">Only employees within this many miles of the event are included. Default is 50 miles.</p>
      </div>
      <button class="px-4 py-2 rounded-lg border border-slate-300 shadow-sm bg-indigo-600 text-white hover:bg-indigo-500" type="submit">Generate SMS List</button>
    </form>
    {% else %}
    <p class="text-sm text-gray-600">Upload an event roster to enable filtering and download the SMS list.</p>
    {% endif %}
  </section>
</div>
{% endblock %}
