{% extends "base.html" %}
{% block title %}Interview Questions — GoLive Tools{% endblock %}
{% block content %}
<section class="max-w-4xl space-y-6">
  <div>
    <h1 class="text-2xl font-semibold mb-2">Interview Questions</h1>
    <p class="text-sm text-gray-700 max-w-2xl">Paste an interview transcript to receive a JSON evaluation you can share with the hiring team.</p>
  </div>

  <div class="p-6 bg-white border border-gray-200 rounded-xl shadow-sm space-y-4">
    <form id="iq-form" class="space-y-4">
      <div>
        <label class="block text-sm font-medium mb-2" for="transcript">Interview transcript</label>
        <textarea
          id="transcript"
          name="transcript"
          rows="12"
          class="w-full border rounded-lg p-3 bg-white shadow-inner focus:outline-none focus:ring-2 focus:ring-indigo-500"
          placeholder="Paste the full transcript here..."
          required
        ></textarea>
        <p class="text-xs text-gray-500 mt-1">Include both interviewer questions and candidate answers for the most accurate feedback.</p>
      </div>
      <div class="flex items-center gap-3">
        <button
          type="submit"
          class="px-4 py-2 rounded-lg bg-indigo-600 text-white font-semibold shadow hover:bg-indigo-500 disabled:opacity-60"
        >
          Evaluate Interview
        </button>
        <span id="iq-status" class="text-sm text-gray-600" role="status"></span>
      </div>
    </form>

    <div id="iq-result" class="hidden border border-dashed border-gray-300 rounded-lg p-4 bg-gray-50 space-y-4">
      <div class="flex items-center justify-between mb-3">
        <div>
          <p class="text-xs font-semibold text-gray-600 uppercase tracking-wide">Overall Recommendation</p>
          <p id="iq-overall" class="text-lg font-bold text-gray-900">—</p>
        </div>
        <button
          id="iq-copy"
          type="button"
          class="px-3 py-1 text-xs font-semibold border rounded-lg bg-white hover:bg-gray-100"
        >
          Copy JSON
        </button>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
        <div class="p-3 bg-white border rounded-lg shadow-sm">
          <p class="text-xs uppercase tracking-wide text-gray-500">Communication</p>
          <p id="iq-score-communication" class="text-xl font-semibold text-gray-900">—</p>
        </div>
        <div class="p-3 bg-white border rounded-lg shadow-sm">
          <p class="text-xs uppercase tracking-wide text-gray-500">Technical</p>
          <p id="iq-score-technical" class="text-xl font-semibold text-gray-900">—</p>
        </div>
        <div class="p-3 bg-white border rounded-lg shadow-sm">
          <p class="text-xs uppercase tracking-wide text-gray-500">Professionalism</p>
          <p id="iq-score-professionalism" class="text-xl font-semibold text-gray-900">—</p>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="p-3 bg-white border rounded-lg shadow-sm space-y-2">
          <p class="text-sm font-semibold text-gray-800">Strengths</p>
          <ul id="iq-strengths" class="list-disc list-inside text-sm text-gray-700 space-y-1">
            <li class="text-gray-500">Waiting for AI response…</li>
          </ul>
        </div>
        <div class="p-3 bg-white border rounded-lg shadow-sm space-y-2">
          <p class="text-sm font-semibold text-gray-800">Concerns</p>
          <ul id="iq-concerns" class="list-disc list-inside text-sm text-gray-700 space-y-1">
            <li class="text-gray-500">Waiting for AI response…</li>
          </ul>
        </div>
      </div>

      <div class="p-3 bg-white border rounded-lg shadow-sm space-y-2">
        <p class="text-sm font-semibold text-gray-800">Notes for Hiring Manager</p>
        <p id="iq-notes" class="text-sm text-gray-700">Waiting for AI response…</p>
      </div>

      <div>
        <div class="flex items-center justify-between mb-2">
          <h2 class="text-sm font-semibold text-gray-800">AI JSON Response</h2>
        </div>
        <pre id="iq-output" class="text-xs whitespace-pre-wrap overflow-x-auto"></pre>
      </div>
    </div>
  </div>
</section>
{% endblock %}

{% block scripts %}
<script>
  const form = document.getElementById("iq-form");
  const statusEl = document.getElementById("iq-status");
  const resultEl = document.getElementById("iq-result");
  const outputEl = document.getElementById("iq-output");
  const copyBtn = document.getElementById("iq-copy");
  const overallEl = document.getElementById("iq-overall");
  const strengthsEl = document.getElementById("iq-strengths");
  const concernsEl = document.getElementById("iq-concerns");
  const notesEl = document.getElementById("iq-notes");
  const scoreCommunicationEl = document.getElementById("iq-score-communication");
  const scoreTechnicalEl = document.getElementById("iq-score-technical");
  const scoreProfessionalismEl = document.getElementById("iq-score-professionalism");

  function renderList(targetEl, items, emptyLabel) {
    targetEl.innerHTML = "";
    if (!items || items.length === 0) {
      const li = document.createElement("li");
      li.className = "text-gray-500";
      li.textContent = emptyLabel;
      targetEl.appendChild(li);
      return;
    }

    items.forEach((item) => {
      const li = document.createElement("li");
      li.textContent = item;
      targetEl.appendChild(li);
    });
  }

  form.addEventListener("submit", async (event) => {
    event.preventDefault();
    resultEl.classList.add("hidden");
    statusEl.textContent = "Submitting transcript...";
    const transcript = (document.getElementById("transcript")?.value || "").trim();

    try {
      const response = await fetch("/interview-questions/evaluate", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ transcript })
      });

      if (!response.ok) {
        const payload = await response.json().catch(() => ({}));
        const detail = payload.detail || payload.error || "Request failed.";
        statusEl.textContent = `Error: ${detail}`;
        return;
      }

      const data = await response.json();
      outputEl.textContent = JSON.stringify(data, null, 2);
      overallEl.textContent = data.overall_recommendation || "—";
      scoreCommunicationEl.textContent = data.scores?.communication ?? "—";
      scoreTechnicalEl.textContent = data.scores?.technical ?? "—";
      scoreProfessionalismEl.textContent = data.scores?.professionalism ?? "—";
      renderList(strengthsEl, data.strengths, "No strengths provided.");
      renderList(concernsEl, data.concerns, "No concerns provided.");
      notesEl.textContent = data.notes_for_hiring_manager || "No notes provided.";
      resultEl.classList.remove("hidden");
      statusEl.textContent = "Response received.";
    } catch (error) {
      statusEl.textContent = "Network error. Please try again.";
    }
  });

  copyBtn.addEventListener("click", async () => {
    const text = outputEl.textContent;
    if (!text) return;
    try {
      await navigator.clipboard.writeText(text);
      statusEl.textContent = "Copied to clipboard.";
      setTimeout(() => (statusEl.textContent = ""), 2000);
    } catch (error) {
      statusEl.textContent = "Unable to copy. Please copy manually.";
    }
  });
</script>
{% endblock %}
